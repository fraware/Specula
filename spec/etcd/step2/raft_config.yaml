# Configuration for etcd raft specification trace validation
# Based on the raft.tla specification

spec_name: "test"  # Name of the main specification module

# Constants used in the specification
# Trace sources will be automatically generated as Trace{ConstantName}
constants:
  - name: "Nodes"
    value: '{"n1", "n2", "n3"}'
  - name: "MaxLogLength"
    value: '3'
  - name: "MaxTerm" 
    value: '3'

# Variables in the specification and their default types
variables:
  - name: "currentTerm"
    default_type: "node_map_int"          # Maps nodes to integers (term numbers)
  - name: "votedFor"
    default_type: "node_map_int"          # Maps nodes to integers (0 for no vote)
  - name: "log"
    default_type: "node_map_sequence"     # Maps nodes to sequences (log entries)
  - name: "commitIndex"
    default_type: "node_map_int"          # Maps nodes to integers (commit index)
  - name: "state"
    default_type: "custom"
    default_value: '[n \\in TraceNodes |-> "Follower"]'  # Maps nodes to states
  - name: "leaderId"
    default_type: "node_map_int"          # Maps nodes to integers (leader ID, 0 for none)
  - name: "nextIndex"
    default_type: "custom"
    default_value: '[n \\in TraceNodes |-> [m \\in TraceNodes |-> 1]]'  # Nested node mapping
  - name: "matchIndex"
    default_type: "custom"
    default_value: '[n \\in TraceNodes |-> [m \\in TraceNodes |-> 0]]'  # Nested node mapping
  - name: "votes"
    default_type: "custom"
    default_value: '[n \\in TraceNodes |-> {}]'  # Maps nodes to sets of nodes
  - name: "electionTimeout"
    default_type: "node_map_bool"         # Maps nodes to boolean values
  - name: "messages"
    default_type: "set"                   # Set of messages

# Actions/operations in the specification
actions:
  - name: "BecomeCandidate"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "BecomeLeader"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "RequestVote"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "HandleVoteRequest"
    parameters:
      - name: "n"
        source: "Nodes"
      - name: "msg"
        source: "messages"  # This would need to be defined in trace
        
  - name: "HandleVoteResponse"
    parameters:
      - name: "n"
        source: "Nodes"
      - name: "msg"
        source: "messages"
        
  - name: "AppendEntries"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "HandleAppendRequest"
    parameters:
      - name: "n"
        source: "Nodes"
      - name: "msg"
        source: "messages"
        
  - name: "HandleAppendResponse"
    parameters:
      - name: "n"
        source: "Nodes"
      - name: "msg"
        source: "messages"
        
  - name: "AdvanceCommitIndex"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "ElectionTimeout"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "HeartbeatTimeout"
    parameters:
      - name: "n"
        source: "Nodes"
        
  - name: "HandleHeartbeat"
    parameters:
      - name: "n"
        source: "Nodes"
      - name: "msg"
        source: "messages"
        
  - name: "HandleHeartbeatResponse"
    parameters:
      - name: "n"
        source: "Nodes"
      - name: "msg"
        source: "messages" 